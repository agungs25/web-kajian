<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Monitor Tensi Harian</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: #f6fdf8; }
    header { background: linear-gradient(135deg, #198754, #0f5132); color: #fff; padding: 24px 16px; text-align: center; border-bottom: 4px solid #0f5132; }
    main { max-width: 800px; margin: 20px auto; padding: 0 16px 32px 16px; }
    .status-box { padding: 12px 16px; border-radius: 12px; margin-top: 16px; font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 10px; border: 1px solid; }
    .status-box.success { background: #d1e7dd; color: #0f5132; border-color: #198754; }
    .status-box.error { background: #f8d7da; color: #842029; border-color: #842029; }
    .status-box.loading { background: #fff3cd; color: #664d03; border-color: #664d03; }
    .card { background: #fff; border-radius: 14px; padding: 16px 20px; border: 1px solid #e6f0ea; box-shadow: 0 2px 8px rgba(16, 94, 60, .06); margin-top: 20px; }
    .btn { display: flex; align-items: center; justify-content: center; gap: 8px; border-radius: 10px; border: none; background: #198754; color: #fff; font-weight: 600; padding: 12px; cursor: pointer; }
    footer { text-align: center; margin: 24px 0 36px; color: #555; font-size: 13px; }
  </style>
</head>
<body>
  <header>
    <h1>Monitor Tensi Harian</h1>
    <p>Aplikasi untuk penderita hipertensi: Catat Tensi Pagi &amp; Sore</p>
  </header>

  <main>
    <div class="user-id-box">
      <strong>ID Pengguna:</strong> <span id="userIdDisplay">Menunggu Autentikasi...</span>
    </div>

    <div id="authStatus" class="status-box loading">
      <i class="fa-solid fa-spinner fa-spin"></i>
      <span>Mencoba autentikasi...</span>
    </div>

    <div class="card">
      <h2><i class="fa-solid fa-file-medical"></i> Input Tensi Baru</h2>
      <div class="input-grid" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
        <div><label>Sistolik</label><input type="number" id="systolic" placeholder="135"></div>
        <div><label>Diastolik</label><input type="number" id="diastolic" placeholder="85"></div>
        <div><label>Pulse</label><input type="number" id="pulse" placeholder="70"></div>
      </div>
      <button id="saveButton" class="btn"><i class="fa-solid fa-floppy-disk"></i><span>Simpan Data</span></button>
    </div>

    <div class="card">
      <h2><i class="fa-solid fa-clock-rotate-left"></i> Riwayat</h2>
      <div id="history">Memuat data...</div>
    </div>
  </main>

  <footer>Dibuat untuk monitoring hipertensi.</footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getDatabase, ref, push, onValue, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

    // --- Firebase Config Pakde (tinggal isi API key) ---
    const firebaseConfig = {
      apiKey: "AIzaSyC70xZ8VsDlfbsa-_JNmNoh6qdf9-PdJgk",
      authDomain: "monitor-tensi.firebaseapp.com",
      databaseURL: "https://monitor-tensi-default-rtdb.firebaseio.com",
      projectId: "monitor-tensi",
      storageBucket: "monitor-tensi.firebasestorage.app",
      messagingSenderId: "917331085991",
      appId: "1:917331085991:web:037e3650f60776db53e982"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    const userIdDisplayEl = document.getElementById("userIdDisplay");
    const authStatusEl = document.getElementById("authStatus");
    const saveButton = document.getElementById("saveButton");
    const historyEl = document.getElementById("history");

    function updateStatus(msg, type="success") {
      authStatusEl.className = `status-box ${type}`;
      authStatusEl.innerHTML = `<i class="fa-solid ${type==="error"?"fa-triangle-exclamation":type==="loading"?"fa-spinner fa-spin":"fa-check-circle"}"></i> <span>${msg}</span>`;
    }

    function renderHistory(data){
      if(!data || !data.length){historyEl.textContent="Belum ada data.";return;}
      historyEl.innerHTML = data.map(r => `<div>${r.date} — ${r.sys}/${r.dia} (${r.pulse||'–'})</div>`).join("");
    }

    onAuthStateChanged(auth, async (user) => {
      if(user){
        updateStatus("Autentikasi sukses.","success");
        userIdDisplayEl.textContent = user.uid;
        const readingsRef = ref(db, "users/"+user.uid+"/readings");
        onValue(readingsRef,(snap)=>{
          const vals=[]; snap.forEach(c=>vals.push(c.val()));
          renderHistory(vals.reverse());
        });
      } else {
        updateStatus("Login anonim...","loading");
        await signInAnonymously(auth);
      }
    });

    saveButton.onclick = async ()=>{
      const sys=parseInt(document.getElementById("systolic").value);
      const dia=parseInt(document.getElementById("diastolic").value);
      const pulse=parseInt(document.getElementById("pulse").value);
      if(!sys||!dia){updateStatus("Isi sistolik & diastolik!","error");return;}
      const u=auth.currentUser;
      if(!u){updateStatus("Belum login.","error");return;}
      await push(ref(db,"users/"+u.uid+"/readings"),{sys,dia,pulse,date:new Date().toLocaleString('id-ID'),createdAt:serverTimestamp()});
      updateStatus("Data tersimpan.","success");
      document.getElementById("systolic").value=document.getElementById("diastolic").value=document.getElementById("pulse").value="";
    };
  </script>
</body>
</html>
